<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Inventario API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Prueba del Endpoint de Inventario</h2>
        
        <div class="mb-3">
            <label for="nneInput" class="form-label">Ingrese NNE para probar:</label>
            <input type="text" class="form-control" id="nneInput" placeholder="Ej: 7021290004418" value="7021290004418">
            <button onclick="probarInventario()" class="btn btn-primary mt-2">Probar Inventario</button>
            <button onclick="probarListaEquipos()" class="btn btn-secondary mt-2">Listar Equipos</button>
            <button onclick="probarUnidadesEquipo()" class="btn btn-info mt-2">Listar Unidades</button>
            <button onclick="probarEstadosEquipo()" class="btn btn-warning mt-2">Listar Estados</button>
            <button onclick="probarEquipoDetallado()" class="btn btn-success mt-2">Equipo Detallado</button>
        </div>

        <div id="resultados" class="mt-4">
            <!-- Los resultados aparecerán aquí -->
        </div>
    </div>

    <script>
        const API_BASE = "https://sistema-control-gestion-backend.onrender.com/api";
        
        async function probarInventario() {
            const nne = document.getElementById('nneInput').value;
            const resultados = document.getElementById('resultados');
            
            if (!nne) {
                resultados.innerHTML = '<div class="alert alert-warning">Por favor ingrese un NNE</div>';
                return;
            }
            
            resultados.innerHTML = '<div class="alert alert-info">Consultando inventario...</div>';
            
            try {
                console.log(`Consultando: ${API_BASE}/equipos/nne/${nne}/inventarioresumen`);
                const response = await fetch(`${API_BASE}/equipos/nne/${nne}/inventarioresumen`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        resultados.innerHTML = `<div class="alert alert-warning">No se encontró el NNE: ${nne}</div>`;
                    } else {
                        throw new Error(`Error ${response.status}: ${response.statusText}`);
                    }
                    return;
                }
                
                const data = await response.json();
                console.log('Respuesta del inventario:', data);
                
                let detalleHTML = '';
                if (data.detalleFueraDeServicio && data.detalleFueraDeServicio.length > 0) {
                    detalleHTML = '<h6>Detalle Fuera de Servicio:</h6><ul>';
                    data.detalleFueraDeServicio.forEach(detalle => {
                        detalleHTML += `<li>${detalle.estado}: ${detalle.cantidad}</li>`;
                    });
                    detalleHTML += '</ul>';
                }
                
                resultados.innerHTML = `
                    <div class="alert alert-success">
                        <h5>Inventario para NNE: ${nne}</h5>
                        <p><strong>Total:</strong> ${data.total}</p>
                        <p><strong>En Servicio:</strong> ${data.enServicio}</p>
                        <p><strong>Fuera de Servicio:</strong> ${data.fueraDeServicio}</p>
                        ${detalleHTML}
                    </div>
                `;
            } catch (error) {
                console.error('Error:', error);
                resultados.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
        
        async function probarListaEquipos() {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="alert alert-info">Consultando lista de equipos...</div>';
            
            try {
                console.log(`Consultando: ${API_BASE}/equipos`);
                const response = await fetch(`${API_BASE}/equipos`);
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Lista de equipos:', data);
                
                let equiposHTML = '<h6>Equipos disponibles:</h6>';
                if (data && data.length > 0) {
                    equiposHTML += '<ul>';
                    data.forEach(equipo => {
                        equiposHTML += `<li>ID: ${equipo.id}, NNE: ${equipo.nne || 'N/A'}, Marca: ${equipo.marca || 'N/A'}, Modelo: ${equipo.modelo || 'N/A'}</li>`;
                    });
                    equiposHTML += '</ul>';
                } else {
                    equiposHTML += '<p>No hay equipos registrados</p>';
                }
                
                resultados.innerHTML = `<div class="alert alert-info">${equiposHTML}</div>`;
            } catch (error) {
                console.error('Error:', error);
                resultados.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
        
        async function probarUnidadesEquipo() {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="alert alert-info">Consultando unidades de equipo...</div>';
            
            try {
                console.log(`Consultando: ${API_BASE}/unidadesequipo`);
                const response = await fetch(`${API_BASE}/unidadesequipo`);
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Unidades de equipo:', data);
                
                let unidadesHTML = '<h6>Unidades disponibles:</h6>';
                if (data && data.length > 0) {
                    unidadesHTML += '<ul>';
                    data.forEach(unidad => {
                        unidadesHTML += `<li>ID: ${unidad.id}, Equipo ID: ${unidad.equipoId}, Serie: ${unidad.nroSerie || 'N/A'}, Estado: ${unidad.estadoId}</li>`;
                    });
                    unidadesHTML += '</ul>';
                } else {
                    unidadesHTML += '<p>No hay unidades registradas</p>';
                }
                
                resultados.innerHTML = `<div class="alert alert-info">${unidadesHTML}</div>`;
            } catch (error) {
                console.error('Error:', error);
                resultados.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
        
        async function probarEstadosEquipo() {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="alert alert-info">Consultando estados de equipo...</div>';
            
            try {
                console.log(`Consultando: ${API_BASE}/estadoequipo`);
                const response = await fetch(`${API_BASE}/estadoequipo`);
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Estados de equipo:', data);
                
                let estadosHTML = '<h6>Estados disponibles:</h6>';
                if (data && data.length > 0) {
                    estadosHTML += '<ul>';
                    data.forEach(estado => {
                        estadosHTML += `<li>ID: ${estado.id}, Nombre: ${estado.nombre}</li>`;
                    });
                    estadosHTML += '</ul>';
                } else {
                    estadosHTML += '<p>No hay estados registrados</p>';
                }
                
                resultados.innerHTML = `<div class="alert alert-info">${estadosHTML}</div>`;
            } catch (error) {
                console.error('Error:', error);
                resultados.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
        
        async function probarEquipoDetallado() {
            const nne = document.getElementById('nneInput').value;
            const resultados = document.getElementById('resultados');
            
            if (!nne) {
                resultados.innerHTML = '<div class="alert alert-warning">Por favor ingrese un NNE</div>';
                return;
            }
            
            resultados.innerHTML = '<div class="alert alert-info">Consultando equipo detallado...</div>';
            
            try {
                console.log(`Consultando: ${API_BASE}/equipos/nne/${nne}`);
                const response = await fetch(`${API_BASE}/equipos/nne/${nne}`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        resultados.innerHTML = `<div class="alert alert-warning">No se encontró el NNE: ${nne}</div>`;
                    } else {
                        throw new Error(`Error ${response.status}: ${response.statusText}`);
                    }
                    return;
                }
                
                const data = await response.json();
                console.log('Equipo detallado:', data);
                
                let unidadesHTML = '';
                if (data.unidades && data.unidades.length > 0) {
                    unidadesHTML = '<h6>Unidades:</h6><ul>';
                    data.unidades.forEach(unidad => {
                        const estadoNombre = unidad.estado ? unidad.estado.nombre : 'Sin estado';
                        const personaNombre = unidad.persona ? `${unidad.persona.nombre} ${unidad.persona.apellido}` : 'Sin asignar';
                        unidadesHTML += `<li>Serie: ${unidad.nroSerie}, Estado: ${estadoNombre}, Persona: ${personaNombre}</li>`;
                    });
                    unidadesHTML += '</ul>';
                } else {
                    unidadesHTML = '<p>No hay unidades para este equipo</p>';
                }
                
                resultados.innerHTML = `
                    <div class="alert alert-success">
                        <h5>Equipo: ${data.nne}</h5>
                        <p><strong>Marca:</strong> ${data.marca || 'N/A'}</p>
                        <p><strong>Modelo:</strong> ${data.modelo || 'N/A'}</p>
                        <p><strong>Tipo:</strong> ${data.tipoNombre || 'N/A'}</p>
                        ${unidadesHTML}
                    </div>
                `;
            } catch (error) {
                console.error('Error:', error);
                resultados.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
